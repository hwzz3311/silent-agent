# Neurone æœåŠ¡å¯åŠ¨æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å¯åŠ¨ Neurone çš„æ‰€æœ‰æœåŠ¡ã€‚

## æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Neurone æ¶æ„                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Chrome    â”‚     â”‚   Chrome    â”‚               â”‚
â”‚  â”‚   æ‰©å±•      â”‚â—„â”€â”€â”€â”€â–ºâ”‚   æµè§ˆå™¨    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â”‚                                            â”‚
â”‚         â”‚ WebSocket (:18792)                         â”‚
â”‚         â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Relay     â”‚     â”‚   API       â”‚               â”‚
â”‚  â”‚   Server    â”‚â”€â”€â”€â”€â–ºâ”‚   Server    â”‚               â”‚
â”‚  â”‚   (:18792)  â”‚     â”‚   (:8080)   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â”‚                    â”‚                      â”‚
â”‚         â”‚                    â–¼                      â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Python    â”‚             â”‚
â”‚                        â”‚   æ§åˆ¶å™¨    â”‚             â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¯åŠ¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
python start_services.py

# åªå¯åŠ¨ Relay (WebSocket)
python start_services.py relay

# åªå¯åŠ¨ API (HTTP)
python start_services.py api
```

### æ–¹å¼äºŒï¼šåˆ†åˆ«å¯åŠ¨

**ç»ˆç«¯ 1 - å¯åŠ¨ Relay æœåŠ¡å™¨**

```bash
cd network_hook/src
python relay_server.py --port 18792
```

**ç»ˆç«¯ 2 - å¯åŠ¨ REST API æœåŠ¡**

```bash
cd network_hook
uvicorn src.api.app:app --host 0.0.0.0 --port 8080 --reload
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬çš„é€‰é¡¹

```bash
# è‡ªå®šä¹‰ç«¯å£
python start_services.py --relay-port 9999 --api-port 3000

# è°ƒè¯•æ¨¡å¼
python start_services.py --log-level DEBUG
```

## å¯åŠ¨åçš„è®¿é—®åœ°å€

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| **Relay WebSocket** | `ws://127.0.0.1:18792` | Chrome æ‰©å±•è¿æ¥ç«¯ç‚¹ |
| **Relay æ‰©å±•è¿æ¥** | `ws://127.0.0.1:18792/extension` | æ‰©å±• WebSocket è¿æ¥ |
| **Relay æ§åˆ¶å™¨è¿æ¥** | `ws://127.0.0.1:18792/controller` | æ§åˆ¶å™¨ WebSocket è¿æ¥ |
| **Relay å¥åº·æ£€æŸ¥** | `http://127.0.0.1:18792/health` | Relay å¥åº·çŠ¶æ€ |
| **REST API** | `http://0.0.0.0:8080` | HTTP API æœåŠ¡ |
| **API æ–‡æ¡£** | `http://0.0.0.0:8080/docs` | Swagger API æ–‡æ¡£ |
| **API å¥åº·æ£€æŸ¥** | `http://0.0.0.0:8080/health` | API å¥åº·çŠ¶æ€ |

## å¯åŠ¨æµç¨‹

### 1. å¯åŠ¨ Relay æœåŠ¡å™¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd network_hook

# å¯åŠ¨ Relay
python src/relay_server.py --port 18792
```

è¾“å‡ºç¤ºä¾‹:
```
ğŸ§  Neurone Relay Server v2 å·²å¯åŠ¨
   WebSocket: ws://127.0.0.1:18792
   Extension: ws://127.0.0.1:18792/extension
   Controller: ws://127.0.0.1:18792/controller
```

### 2. å¯åŠ¨ REST API æœåŠ¡

```bash
# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
pip install fastapi uvicorn

# å¯åŠ¨ API æœåŠ¡
uvicorn src.api.app:app --host 0.0.0.0 --port 8080 --reload
```

### 3. åŠ è½½ Chrome æ‰©å±•

1. æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè®¿é—® `chrome://extensions/`
2. å¯ç”¨å³ä¸Šè§’çš„ã€Œå¼€å‘è€…æ¨¡å¼ã€
3. ç‚¹å‡»ã€ŒåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€
4. é€‰æ‹© `network_hook/extension` ç›®å½•
5. ç‚¹å‡»æ‰©å±•å›¾æ ‡ï¼Œç¡®è®¤çŠ¶æ€ä¸º **ON**ï¼ˆç»¿è‰²ï¼‰

### 4. éªŒè¯æœåŠ¡çŠ¶æ€

#### ä½¿ç”¨ curl

```bash
# æ£€æŸ¥ Relay å¥åº·
curl http://127.0.0.1:18792/health

# æ£€æŸ¥ API å¥åº·
curl http://127.0.0.1:8080/health
```

#### ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# Python æµ‹è¯•
python tests_api.py verify

# Shell æµ‹è¯•
./test_api.sh health
```

## é…ç½®æ–‡ä»¶

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `NEURONE_RELAY_PORT` | Relay ç«¯å£ | 18792 |
| `NEURONE_API_PORT` | API ç«¯å£ | 8080 |
| `NEURONE_API_HOST` | API ä¸»æœº | 0.0.0.0 |
| `NEURONE_LOG_LEVEL` | æ—¥å¿—çº§åˆ« | INFO |

### ä½¿ç”¨ç¤ºä¾‹

```bash
export NEURONE_RELAY_PORT=9999
export NEURONE_API_PORT=3000
python start_services.py
```

## æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :18792
lsof -i :8080

# æˆ–ä½¿ç”¨ netstat
netstat -tlnp | grep -E '18792|8080'
```

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å…¶ä»–ç«¯å£

```bash
# ä½¿ç”¨ä¸åŒç«¯å£å¯åŠ¨
python start_services.py --relay-port 18793 --api-port 8081
```

### é—®é¢˜ 2ï¼šä¾èµ–ç¼ºå¤±

```bash
# å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# æˆ–å•ç‹¬å®‰è£…
pip install websockets fastapi uvicorn pydantic
```

### é—®é¢˜ 3ï¼šChrome æ‰©å±•æ— æ³•è¿æ¥

1. æ£€æŸ¥ Relay æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
2. æ£€æŸ¥æ‰©å±•æ˜¯å¦å·²åŠ è½½
3. æ£€æŸ¥ç«¯å£é…ç½®æ˜¯å¦ä¸€è‡´
4. æŸ¥çœ‹æ‰©å±• Service Worker æ—¥å¿—:
   - è®¿é—® `chrome://extensions/`
   - æ‰¾åˆ° Neurone æ‰©å±•
   - ç‚¹å‡»ã€ŒService Workerã€æŸ¥çœ‹æ—¥å¿—

### é—®é¢˜ 4ï¼šå·¥å…·æ‰§è¡Œå¤±è´¥

1. ç¡®ä¿ç›®æ ‡ç½‘ç«™å·²æˆæƒ
2. æ£€æŸ¥é€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

## ä½¿ç”¨ API æµ‹è¯•æœåŠ¡

### å¯åŠ¨æµ‹è¯•

```bash
# å¿«é€ŸéªŒè¯ API æ˜¯å¦å¯ç”¨
python tests_api.py verify

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python tests_api.py

# è¿è¡Œç‰¹å®šæµ‹è¯•
python tests_api.py tools
python tests_api.py execute
```

### Shell æµ‹è¯•

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x test_api.sh

# è¿è¡Œæµ‹è¯•
./test_api.sh
```

## Docker å¯åŠ¨ï¼ˆå¯é€‰ï¼‰

```dockerfile
# Dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY . .

RUN pip install -r requirements.txt

EXPOSE 18792 8080

CMD ["python", "start_services.py"]
```

```bash
# æ„å»ºå’Œè¿è¡Œ
docker build -t neurone .
docker run -p 18792:18792 -p 8080:8080 neurone
```

## æ³¨æ„äº‹é¡¹

1. **ç«¯å£é…ç½®**: é»˜è®¤ä½¿ç”¨ 18792 (Relay) å’Œ 8080 (API)
2. **å¯åŠ¨é¡ºåº**: å…ˆå¯åŠ¨ Relayï¼Œå†åŠ è½½æ‰©å±•ï¼Œæœ€åå¯åŠ¨ API
3. **æƒé™é—®é¢˜**: å¦‚æœç«¯å£è¢«æ‹’ç»ï¼Œæ£€æŸ¥é˜²ç«å¢™è®¾ç½®
4. **å†…å­˜å ç”¨**: ä¸¤ä¸ªæœåŠ¡éƒ½ä¼šå ç”¨ä¸€å®šå†…å­˜